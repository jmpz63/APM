# Klipper Joint1 (Base Yaw) Template Configuration
# Adjust MCU pins and driver settings to match hardware.

[stepper_a]
step_pin: <MCU_PIN_STEP>
dir_pin: <MCU_PIN_DIR>
enable_pin: <MCU_PIN_EN>
microsteps: 4
full_steps_per_rotation: 200
rotation_distance: 360        # 1 motor rev = 360 'deg units'
gear_ratio: 10:1              # motor:joint
position_endstop: 90          # physical switch at +90Â° from center
position_min: -90
position_max: 90
homing_speed: 10              # deg/s first pass
second_homing_speed: 3
homing_retract_dist: 5
run_current: 0.30             # A (initial safe test current)
hold_current: 0.20            # A
# driver: tmc5160             # Uncomment and add driver specific params if used
# sense_resistor: 0.050

[endstop_phase]
# Optional: fine tune after verifying repeatability.

[gcode_macro HOME_J1]
description: Home Joint1 and apply -90 deg offset so limit becomes +90 and center = 0
gcode:
  G28 A
  SET_GCODE_OFFSET AXIS=A OFFSET=-90
  RESPOND PREFIX="J1" MSG="Homed J1 (center set to 0 deg)"

[gcode_macro J1_CENTER]
description: Move Joint1 to mechanical center (0 deg logical)
gcode:
  G1 A0 F1800

[gcode_macro J1_EXCURSION_TEST]
description: Sweep Joint1 +30 -> -30 -> 0
gcode:
  G1 A30 F1800
  G1 A-30 F1800
  G1 A0 F1800

# Optional auto-offset at startup (after homing):
#[delayed_gcode APPLY_J1_OFFSET]
#initial_duration: 1
#gcode:
#  SET_GCODE_OFFSET AXIS=A OFFSET=-90
